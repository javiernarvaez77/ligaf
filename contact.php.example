<?php
/**
 * Formulario de Contacto - Liga de FÃºtbol de NariÃ±o
 *
 * Renombra este archivo a "contact.php" para activarlo
 * AsegÃºrate de configurar tu email en la lÃ­nea 15
 */

// ConfiguraciÃ³n
header('Content-Type: application/json; charset=utf-8');
header('Access-Control-Allow-Origin: *');

// Email donde recibirÃ¡s los mensajes
$destinatario = "contacto@ligafutbolnarino.com"; // âš ï¸ CAMBIAR POR TU EMAIL

// Validar que sea POST
if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    http_response_code(405);
    echo json_encode([
        'success' => false,
        'message' => 'MÃ©todo no permitido'
    ]);
    exit;
}

// Obtener datos del formulario
$nombre = isset($_POST['nombre']) ? limpiarDatos($_POST['nombre']) : '';
$email = isset($_POST['email']) ? limpiarDatos($_POST['email']) : '';
$telefono = isset($_POST['telefono']) ? limpiarDatos($_POST['telefono']) : '';
$asunto = isset($_POST['asunto']) ? limpiarDatos($_POST['asunto']) : '';
$mensaje = isset($_POST['mensaje']) ? limpiarDatos($_POST['mensaje']) : '';

// Validaciones
$errores = [];

if (empty($nombre)) {
    $errores[] = "El nombre es obligatorio";
}

if (empty($email) || !filter_var($email, FILTER_VALIDATE_EMAIL)) {
    $errores[] = "El email no es vÃ¡lido";
}

if (empty($telefono)) {
    $errores[] = "El telÃ©fono es obligatorio";
}

if (empty($asunto)) {
    $errores[] = "Debes seleccionar un tema";
}

if (empty($mensaje)) {
    $errores[] = "El mensaje no puede estar vacÃ­o";
}

// Si hay errores, retornar
if (!empty($errores)) {
    http_response_code(400);
    echo json_encode([
        'success' => false,
        'message' => implode(', ', $errores)
    ]);
    exit;
}

// Construir el mensaje
$asuntoEmail = "Contacto Web - Liga FÃºtbol NariÃ±o: " . $asunto;

$cuerpoEmail = "
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          NUEVO MENSAJE DESDE EL SITIO WEB                    â•‘
â•‘          Liga de FÃºtbol de NariÃ±o                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ INFORMACIÃ“N DEL REMITENTE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Nombre:         $nombre
Email:          $email
TelÃ©fono:       $telefono
Asunto:         $asunto

ğŸ’¬ MENSAJE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
$mensaje

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“… Fecha: " . date('d/m/Y H:i:s') . "
ğŸŒ IP: " . $_SERVER['REMOTE_ADDR'] . "
ğŸ“± User Agent: " . $_SERVER['HTTP_USER_AGENT'] . "
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Este mensaje fue enviado desde el formulario de contacto del sitio web.
";

// Headers del email
$headers = [
    'From: Liga de FÃºtbol de NariÃ±o <noreply@ligafutbolnarino.com>',
    'Reply-To: ' . $email,
    'X-Mailer: PHP/' . phpversion(),
    'MIME-Version: 1.0',
    'Content-Type: text/plain; charset=UTF-8'
];

// Enviar email
$emailEnviado = mail(
    $destinatario,
    $asuntoEmail,
    $cuerpoEmail,
    implode("\r\n", $headers)
);

// Respuesta
if ($emailEnviado) {
    // Email de confirmaciÃ³n al remitente (opcional)
    enviarConfirmacion($email, $nombre);

    // Guardar en base de datos (opcional)
    // guardarEnBD($nombre, $email, $telefono, $asunto, $mensaje);

    // Respuesta exitosa
    echo json_encode([
        'success' => true,
        'message' => 'Â¡Mensaje enviado exitosamente! Nos pondremos en contacto pronto.'
    ]);
} else {
    http_response_code(500);
    echo json_encode([
        'success' => false,
        'message' => 'Error al enviar el mensaje. Por favor intenta mÃ¡s tarde o contÃ¡ctanos directamente.'
    ]);
}

// Funciones auxiliares
function limpiarDatos($dato) {
    $dato = trim($dato);
    $dato = stripslashes($dato);
    $dato = htmlspecialchars($dato);
    return $dato;
}

function enviarConfirmacion($email, $nombre) {
    $asunto = "ConfirmaciÃ³n - Liga de FÃºtbol de NariÃ±o";

    $mensaje = "
Hola $nombre,

Hemos recibido tu mensaje correctamente.

Nuestro equipo revisarÃ¡ tu consulta y nos pondremos en contacto contigo a la brevedad posible.

Mientras tanto, te invitamos a seguirnos en nuestras redes sociales:
ğŸ“˜ Facebook: [Tu pÃ¡gina de Facebook]
ğŸ“¸ Instagram: [Tu Instagram]

Gracias por contactar a la Liga de FÃºtbol de NariÃ±o.

Saludos cordiales,
Liga de FÃºtbol de NariÃ±o
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Este es un mensaje automÃ¡tico, por favor no responder a este email.
    ";

    $headers = [
        'From: Liga de FÃºtbol de NariÃ±o <contacto@ligafutbolnarino.com>',
        'MIME-Version: 1.0',
        'Content-Type: text/plain; charset=UTF-8'
    ];

    mail($email, $asunto, $mensaje, implode("\r\n", $headers));
}

/**
 * FunciÃ³n opcional para guardar en base de datos
 * Descomenta y configura si quieres mantener un registro
 */
/*
function guardarEnBD($nombre, $email, $telefono, $asunto, $mensaje) {
    try {
        $pdo = new PDO('mysql:host=localhost;dbname=ligafutbol', 'usuario', 'contraseÃ±a');
        $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

        $sql = "INSERT INTO contactos (nombre, email, telefono, asunto, mensaje, fecha, ip)
                VALUES (:nombre, :email, :telefono, :asunto, :mensaje, NOW(), :ip)";

        $stmt = $pdo->prepare($sql);
        $stmt->execute([
            ':nombre' => $nombre,
            ':email' => $email,
            ':telefono' => $telefono,
            ':asunto' => $asunto,
            ':mensaje' => $mensaje,
            ':ip' => $_SERVER['REMOTE_ADDR']
        ]);

        return true;
    } catch (PDOException $e) {
        error_log("Error BD: " . $e->getMessage());
        return false;
    }
}
*/

/**
 * SQL para crear la tabla de contactos (opcional)
 *
 * CREATE TABLE contactos (
 *     id INT AUTO_INCREMENT PRIMARY KEY,
 *     nombre VARCHAR(255) NOT NULL,
 *     email VARCHAR(255) NOT NULL,
 *     telefono VARCHAR(50) NOT NULL,
 *     asunto VARCHAR(255) NOT NULL,
 *     mensaje TEXT NOT NULL,
 *     fecha DATETIME NOT NULL,
 *     ip VARCHAR(50),
 *     leido BOOLEAN DEFAULT FALSE,
 *     respondido BOOLEAN DEFAULT FALSE,
 *     INDEX idx_fecha (fecha),
 *     INDEX idx_leido (leido)
 * ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
 */
?>